<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planet Spotter — Dashboard</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="space-bg">
    <header class="header">
      <div class="logo">
        <div class="planet-icon"></div>
        <h1>Planet <span>Spotter</span></h1>
      </div>
      <nav class="nav-menu">
        <a href="index.html">Upload</a>
        <a href="dashboard.html">Dashboard</a>
      </nav>
    </header>

    <main class="container">
      <div class="dashboard-container">
        <section class="charts-block">
          <!-- BLOCO 1 -->
          <div class="graph-block">
            <div class="card text-card">
              <span id="totalEntries" class="highlight">0</span> entries analyzed
            </div>
            <div class="chart">
              <canvas id="chart1"></canvas>
              <p>
                <span id="percentConfirmed" class="highlight">0%</span> of the analyzed entries were confirmed as real exoplanets
              </p>
            </div>
            <div class="cards-block">
              <div class="card">
                <span id="confirmedExoplanets" class="highlight">0</span> inputs were real exoplanets
              </div>
            </div>
          </div>

          <!-- BLOCO 2 -->
          <div class="graph-block">
            <div class="card text-card">
              <span id="starsWithPlanets" class="highlight">0</span> stars with exoplanets
            </div>
            <div class="chart">
              <canvas id="chart2"></canvas>
            </div>
            <div class="cards-block">
              <div class="card">
                <span id="starsWithoutPlanetsCard" class="highlight">0</span> stars do not have exoplanets
              </div>
              <div class="card">
                Each star contains an average of <span id="avgPerStar" class="highlight">0</span> exoplanets
              </div>
            </div>
          </div>
        </section>

        <!-- DOWNLOAD -->
        <p class="note">
          If you wish, you can download the file with the analyzed data below.
        </p>
        <button id="downloadBtn" class="download-btn">⬇ Download Data</button>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.body.classList.add("fade-in");

        const data = JSON.parse(localStorage.getItem("exoplanetData")) || {};

        // BLOCO 1 — Exoplanetas confirmados
        document.getElementById("totalEntries").textContent = data.total_entries || 0;
        document.getElementById("percentConfirmed").textContent = (data.percent_confirmed || 0).toFixed(4) + "%";
        document.getElementById("confirmedExoplanets").textContent = data.confirmed_exoplanets || 0;

        // BLOCO 2 — Estrelas com/sem exoplanetas
        const starsWithExoplanets = data.stars_with_exoplanets || 8214;
        const totalStarsObserved = data.total_stars_observed || 10000; // ajuste conforme dataset
        const starsWithoutExoplanets = totalStarsObserved - starsWithExoplanets;

        document.getElementById("starsWithPlanets").textContent = starsWithExoplanets;
        document.getElementById("starsWithoutPlanetsCard").textContent = starsWithoutExoplanets;
        document.getElementById("avgPerStar").textContent = (data.avg_exoplanets_per_star || 1.6).toFixed(4);

        // GRÁFICO 1 — Exoplanetas confirmados
        new Chart(document.getElementById("chart1"), {
          type: "doughnut",
          data: {
            labels: ["Exoplanets", "Others"],
            datasets: [{
              data: [data.percent_confirmed || 0, 100 - (data.percent_confirmed || 0)],
              backgroundColor: ["#ffb300", "#222844"],
              borderWidth: 0
            }]
          },
          options: {
            cutout: "70%",
            plugins: {
              legend: {
                display: true,
                 labels: {
                  color: '#fff'}
              },
              datalabels: {
                color: "#fff",
                font: { size: 14, weight: "bold" },
                formatter: (value) => value.toFixed(4)
              }
            }
          },
          plugins: [ChartDataLabels]
        });

        // GRÁFICO 2 — Estrelas com vs sem exoplanetas
        new Chart(document.getElementById("chart2"), {
          type: "doughnut",
          data: {
            labels: ["With Exoplanets", "Without Exoplanets"],
            datasets: [{
              data: [starsWithExoplanets, starsWithoutExoplanets],
              backgroundColor: ["#ffb300", "#222844"],
              borderWidth: 0
            }]
          },
          options: {
            cutout: "70%",
            plugins: {
              legend: {
                display: true,
                 labels: {
                  color: '#fff'}
              },
              datalabels: {
                color: "#fff",
                font: { size: 14, weight: "bold" },
                formatter: (value) => value.toFixed(0)
              }
            }
          },
          plugins: [ChartDataLabels]
        });

        // Download CSV
        document.getElementById("downloadBtn").addEventListener("click", () => {
          if (data.download_csv) {
            window.location.href = "https://exobridgeapi.onrender.com" + data.download_csv;
          } else {
            alert("No download link available");
          }
        });
      });
    </script>
  </body>
</html>

