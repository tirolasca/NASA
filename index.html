<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planet Spotter ‚Äî Upload Data</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link rel="stylesheet" href="style.css" />
  </head>

  <body class="space-bg">
    <header class="header">
      <div class="logo">
        <div class="planet-icon"></div>
        <h1>Planet <span>Spotter</span></h1>
      </div>
      <nav class="nav-menu">
        <a href="index.html">Upload</a>
        <a href="dashboard.html">Dashboard</a>
      </nav>
    </header>

    <main>
      <div class="upload-container">
        <h2>Upload Planet Data</h2>
        <p>
          Attention! Your <strong>.csv</strong> file must follow the same
          variable order as the
          <strong>Kepler Objects of Interest</strong> dataset available on the
          NASA Exoplanet Archive website.
        </p>

        <input type="file" id="fileInput" accept=".csv" hidden />

        <button id="uploadBtn" class="upload-btn">
          <i class="fa-solid fa-file-arrow-up icon"></i> Select File
        </button>

        <p id="fileName" class="file-name"></p>

        <button class="save-btn" id="saveBtn">
          <i class="fa-solid fa-floppy-disk icon"></i> Save and Edit
        </button>
      </div>
    </main>

    <script>
      const uploadBtn = document.getElementById("uploadBtn");
      const fileInput = document.getElementById("fileInput");
      const fileName = document.getElementById("fileName");
      const saveBtn = document.getElementById("saveBtn");

      uploadBtn.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", () => {
        if (fileInput.files.length > 0) {
          const name = fileInput.files[0].name;
          fileName.textContent = "üìÇ File selected: " + name;
          uploadBtn.innerHTML =
            '<i class="fa-solid fa-check icon"></i> Uploaded';
          uploadBtn.disabled = true;
          uploadBtn.style.background = "#2ecc71";
        }
      });

      saveBtn.addEventListener("click", async () => {
        if (!fileInput.files.length) {
          alert("Please select a CSV file first!");
          return;
        }

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append("file", file);

        saveBtn.disabled = true;
        saveBtn.innerHTML = "‚è≥ Analyzing...";

        try {
          const response = await fetch("https://exobridgeapi.onrender.com/predict_exoplanets", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (data.erro) {
            alert("‚ùå Error: " + data.erro);
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk icon"></i> Save and Edit';
            return;
          }

          localStorage.setItem("exoplanetData", JSON.stringify(data));

          alert(`‚úÖ Analysis complete! File: ${data.filename}`);

          fadeOutAndRedirect("dashboard.html");

        } catch (err) {
          alert("‚ùå Failed to connect to the API: " + err.message);
          saveBtn.disabled = false;
          saveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk icon"></i> Save and Edit';
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        document.body.classList.add("fade-in");
      });

      function fadeOutAndRedirect(href) {
        document.body.classList.remove("fade-in");
        document.body.classList.add("fade-out");
        setTimeout(() => {
          window.location.href = href;
        }, 600);
      }
    </script>
  </body>
</html>
